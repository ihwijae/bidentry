# 전자조달 사이트 입찰참가신청 자동화 아키텍처 제안서

대상 사이트:

- 한전 전자조달: https://srm.kepco.net/index.do
- 국방부 전자조달: https://www.d2b.go.kr/index.do

목표:

> 다수 협력사에 대해 **입찰참가신청(참가신청 등록)** 과정을 자동화하여  
> 반복 작업(로그인 → 인증서 선택 → 공고번호 입력 → 참가신청)을 최소화하는 전용 에이전트 구현

---

## 1. 요구 기능 정리

### 1.1 공통 기능

1. **사이트 선택**
   - UI에서 `한전 / 국방부` 중 하나 선택
   - 공고번호 입력
   - 사용할 **협력사 계정 + 인증서** 선택

2. **로그인**
   - 사이트별 로그인 페이지 접속
   - ID / PW 입력 및 로그인 버튼 클릭

3. **공인인증서(전자서명) 인증**
   - 로그인 이후 또는 입찰/참가 단계에서 뜨는 **공인인증서/전자서명 선택 창** 처리
   - 목록에서 사용자가 미리 지정한 인증서를 찾아 선택
   - 비밀번호 입력 후 확인

4. **공고번호 기반 참가신청**
   - 공고 검색 메뉴 진입
   - 공고번호 입력 후 검색
   - 검색 결과에서 대상 공고 선택
   - “참가신청” 버튼 클릭
   - 중간 확인 팝업(alert/confirm 등) 처리

5. **협력사 다건 처리**
   - 동일 공고에 대해 여러 협력사의 계정/인증서를 사용해 **반복 참가신청** 수행
   - UI에서 “이 공고에 대해 A/B/C 협력사 모두 참가신청” 같은 배치 실행 가능

---

## 2. 기술 스택 제안

### 2.1 UI 레이어 (프론트엔드)

- **Electron + Node.js (기존 유지)**
  - 역할:
    - 협력사 계정 관리 UI
    - 공고번호·사이트 선택 UI
    - 실행 버튼/진행 상태 표시
    - 로그/에러 메시지 시각화
  - 장점:
    - 이미 사용 중인 스택 그대로 활용
    - 로컬 데스크톱 앱 형태로 배포 용이

### 2.2 자동화 코어 (백엔드 에이전트)

- **Python + Selenium WebDriver**
  - 역할:
    - 브라우저(Chrome/Edge) 제어
    - 로그인/공고번호 입력/참가신청 등 **웹 페이지 내부 DOM 자동화**
  - 이유:
    - 공공/전자조달 사이트 자동화 사례가 대부분 Selenium + Python 기반
    - 브라우저 호환성(특히 Edge/Chrome), 레거시 대응 경험이 풍부
    - Python 생태계(Selenium, requests, win32 API 등) 활용 가능

- **Python + pywinauto 또는 AutoIt 연동**
  - 역할:
    - 공인인증서/전자서명 선택 팝업 등 **윈도우 네이티브 창 제어**
    - 인증서 목록에서 특정 인증서 찾기, 패스워드 입력, 확인 버튼 클릭
  - 이유:
    - 인증서 선택 창, 키보드보안 모듈 팝업 등은 HTML이 아니라 **OS 레벨 윈도우**인 경우가 대부분
    - 브라우저 자동화 도구(Playwright/Selenium)만으로는 제어 불가
    - pywinauto/AutoIt이 이런 윈도우 컨트롤 제어에 특화

---

## 3. 전체 아키텍처 개요

### 3.1 구성도 (논리 구조)

- **Electron App (Node)**
  - 사용자 입력 UI
  - 작업 요청 생성
  - 결과/로그 표시

- **Bid Agent (Python 서비스)**
  - API/IPC 서버 (예: `HTTP REST` 또는 `stdin/stdout` 기반 IPC)
  - 사이트별 자동화 모듈
    - `kepco_srm_agent.py`
    - `d2b_agent.py`
  - 공통 인증서 처리 모듈
    - `cert_selector.py` (pywinauto/AutoIt 사용)

---

### 3.2 호출 흐름 (요약)

1. 사용자가 Electron에서:
   - 사이트 선택 (한전/국방부)
   - 공고번호 입력
   - 협력사 계정/인증서 선택 후 “참가신청 실행” 클릭

2. Electron → Python Agent 호출:
   - 예: `POST /apply-participation`
   - Body:
     - `site`: `"kepco"` 또는 `"d2b"`
     - `bid_no`: 공고번호
     - `partner_account`: 계정 ID/PW
     - `cert_profile`: 사용할 인증서 정보(인증서 식별명, 비밀번호 등)

3. Python Agent:
   - 해당 사이트 모듈 호출 (`KepcoSrmAgent.run(...)`, `D2bAgent.run(...)`)
   - Selenium으로 브라우저 제어
   - 인증서 팝업 발생 시 `cert_selector.py` 호출
   - 최종 참가신청 결과/로그 수집

4. Python Agent → Electron 응답:
   - 성공/실패 상태
   - 에러 메시지(어느 단계에서 실패했는지)
   - 필요 시 스크린샷 경로 전달

---

## 4. 사이트별 동작 플로우

### 4.1 KEPCO SRM (srm.kepco.net)

1. **로그인 페이지 진입**
   - `https://srm.kepco.net/index.do` 접속
   - 로그인 버튼/메뉴 클릭 (필요 시)

2. **ID/PW 입력**
   - 협력사 개별 계정 사용
   - ID/PW 입력 후 로그인 버튼 클릭

3. **공인인증서/전자서명 창 처리**
   - 인증서 선택 팝업이 발생하면:
     - `cert_selector.py`에서 해당 윈도우를 탐색
     - 목록에서 지정된 인증서명(DN 또는 별칭)과 매칭되는 항목 클릭
     - 비밀번호 입력 후 확인
   - 오류 시:
     - 잘못된 인증서/비밀번호 → 에러코드 반환

4. **공고 검색 & 참가신청**
   - 입찰/공고 검색 메뉴 이동
   - 공고번호 입력 후 검색
   - 해당 공고 row 클릭
   - “참가신청” 버튼 클릭
   - 중간 경고/확인 alert 처리
   - 완료 후 상태 반환

---

### 4.2 국방부 전자조달 (d2b.go.kr)

1. **로그인 페이지 진입**
   - `https://www.d2b.go.kr/index.do` 접속
   - 로그인 메뉴로 이동 (공급업체/협력업체용 로그인 메뉴)

2. **ID/PW 입력**
   - 협력사 계정 기준 로그인
   - 로그인 버튼 클릭

3. **공인인증서/전자서명 창 처리**
   - 한전과 동일한 방식:
     - `cert_selector.py` 사용
     - 인증서 선택 + 비밀번호 입력 후 확인

4. **공고 검색 & 참가신청**
   - 입찰공고 검색 메뉴 이동
   - 공고번호 입력 후 검색
   - 대상 공고 선택
   - “참가신청” 버튼 클릭
   - 필요한 경우 추가 동의/체크박스 처리
   - 완료 후 상태 반환

---

## 5. 모듈/파일 설계 초안

### 5.1 최상위 구조 (예시)

```text
project-root/
  electron-app/
    src/
      main/
      renderer/
      ...
  bid-agent/        # Python 기반 자동화 코어
    main.py
    config/
      sites.yaml
      partners.yaml
      cert_profiles.yaml
    core/
      agent_server.py         # Electron과 통신 (REST/IPC)
      browser_manager.py      # Selenium WebDriver 생성/관리
      cert_selector.py        # pywinauto/AutoIt 기반 인증서 창 제어
    sites/
      kepco_srm_agent.py      # 한전 SRM 전용 로직
      d2b_agent.py            # 국방부 D2B 전용 로직
    logs/
      ...
