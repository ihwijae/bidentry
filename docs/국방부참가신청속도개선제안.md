# 국방부 참가신청 속도 개선 제안

향후 속도 최적화가 필요할 때 참고할 아이디어를 정리했습니다. 모든 개선은 성공/실패 재현성에 영향을 줄 수 있으므로 적용 시 충분한 검증이 필요합니다.

## 1. 사후심사대상 입찰안내 팝업 닫기 속도
- **현상**: 팝업 DOM이 완전히 렌더링되고 애니메이션이 끝난 뒤 닫기 버튼을 클릭하도록 대기 시간이 길게 설정되어 있습니다.
- **가능한 개선**
  1. `waitForTimeout` 값을 축소해서 팝업 표시 감지를 빠르게 재시도.
  2. 팝업이 떠 있는지 확인된 순간 `document.querySelector('#popupId').remove()` 같은 강제 제거 시도.
  3. 팝업 감시 루프를 `Promise.any` 형태로 만들어 첫 감지 시 바로 닫기.
- **리스크**: DOM이 아직 준비되지 않은 상태에서 조작하면 자바스크립트 예외가 나거나 팝업이 남은 채 다음 단계로 넘어가 실패 가능성이 높습니다.

## 2. 로그인/인증서 직후 공고번호 입력까지
- **현상**: 로그인 성공 후 홈/검색 페이지로 이동하면서 `waitForNavigation`, `waitForLoadState`, `waitForTimeout` 등을 거친 뒤 공고번호 입력을 시작합니다.
- **가능한 개선**
  1. 명시적인 `waitForTimeout`을 제거하고 핵심 요소(`#bidNoticeSearchForm`, 입력 필드 등) 감지에 성공하는 즉시 입력 시작.
  2. `Promise.race` 형태로 DOM 준비와 타임아웃을 동시에 기다려, 필드가 보이는 즉시 작업.
  3. 공고번호 필드에 대한 `page.fill` 대신 `evaluate(() => element.value = bid)`로 직접 값 주입하여 키 입력 지연을 줄임.
- **리스크**: 페이지가 완전히 로딩되기 전에 조작을 시작하면 필드가 비거나 포커스가 이동되어 입력이 누락될 수 있습니다. 오류 재현이 어려워질 수 있음.

## 3. 공고번호 입력 후 검색 버튼 클릭까지
- **현상**: `scrollIntoView`, `ensureVisible`, 확인을 위한 추가 대기 등을 거쳐 안정성을 확보한 뒤 검색 버튼을 클릭합니다.
- **가능한 개선**
  1. 스크롤 및 가시성 체크를 최소화하고, 버튼이 DOM에 나타나기만 하면 즉시 `click()` 호출.
  2. 검색 요청을 폼 제출(`form.submit()`) 방식으로 직접 트리거하여 UI 경로를 생략.
  3. `waitForNavigation` 대신 `page.waitForURL` 등 조건을 완화하거나, `Promise.any`로 버튼 클릭 후 바로 다음 단계 준비.
- **리스크**: 버튼이 비활성 상태거나 뷰포트 밖에 있을 때 강제 클릭하면 무시되거나 이벤트가 전파되지 않을 수 있습니다. 폼을 직접 제출하면 사이트 스크립트가 기대하는 검증 로직을 건너뛰어 예상치 못한 오류가 날 수 있습니다.

## 적용 시 공통 주의사항
- 속도 향상으로 인한 실패 가능성이 높아질 수 있으므로, 개선 전/후 `engine_runs` 덤프 및 로그 비교를 통해 안정성을 확인해야 합니다.
- 옵션으로 동작하도록 만들어 필요할 때만 켜고, 실패 시 즉시 되돌릴 수 있도록 버전 관리를 철저히 하는 것이 좋습니다.
- 각 단계의 타임아웃 단축/DOM 강제 조작은 환경(네트워크/CPU)에 따라 크게 영향을 받으므로, 테스트 환경과 실제 운영 환경의 차이를 고려해야 합니다.
